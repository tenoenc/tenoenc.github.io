---
layout: post
title: "[Computer Structure] CPU Cacheì™€ False Sharing"
date: 2026-01-11 11:03 +0900
math: true
categories:
- Computer Science
- Operating System & Computer Structure
tags:
- Computer Structure
- CPU Cache
- False Sharing
image:
    path: /assets/img/2026-01-11-12-11-25.png
---

í˜„ëŒ€ì˜ CPU í´ëŸ­ ì†ë„ëŠ” ê¸°ê°€í—¤ë¥´ì¸ (GHz) ë‹¨ìœ„ì— ë„ë‹¬í•˜ì—¬ ë‚˜ë…¸ì´ˆ(ns) ë¯¸ë§Œì˜ ê°„ê²©ìœ¼ë¡œ ëª…ë ¹ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. ë°˜ë©´ ë©”ì¸ ë©”ëª¨ë¦¬(DRAM)ëŠ” ë¬¼ë¦¬ì  êµ¬ì¡°ìƒì˜ í•œê³„ë¡œ ì¸í•´ ë°ì´í„° ìš”ì²­ í›„ ì‘ë‹µê¹Œì§€ ì•½ 100ns ì´ìƒì˜ ì‹œê°„ì´ ì†Œìš”ë©ë‹ˆë‹¤. ì´ ìˆ˜ë°± ë°°ì— ë‹¬í•˜ëŠ” ì†ë„ ê²©ì°¨ë¥¼ ë©”ìš°ê¸° ìœ„í•´, í•˜ë“œì›¨ì–´ëŠ” ì—°ì‚° ì¥ì¹˜ì™€ ë©”ëª¨ë¦¬ ì‚¬ì´ì— SRAM ê¸°ë°˜ì˜ ê³ ì† ì €ì¥ì†Œì¸ ìºì‹œë¥¼ ê³„ì¸µì ìœ¼ë¡œ ë°°ì¹˜í•©ë‹ˆë‹¤. ë°ì´í„°ëŠ” ì´ ê³„ì¸µì„ ê±°ì¹˜ë©° ê° ì¸µì˜ ë¬¼ë¦¬ì  ê±°ë¦¬ì— ë”°ë¥¸ ì§€ì—° ì‹œê°„ê³¼ ìš©ëŸ‰ì˜ íŠ¸ë ˆì´ë“œì˜¤í”„ë¥¼ ë§ˆì£¼í•˜ê²Œ ë©ë‹ˆë‹¤.

## ğŸ§© Cache

ë°ì´í„°ê°€ ë©”ëª¨ë¦¬ë¡œë¶€í„° CPUë¡œ ì´ë™í•˜ëŠ” ì—¬ì •ì˜ ìµœì†Œ ë‹¨ìœ„ëŠ” **64ë°”ì´íŠ¸ ìºì‹œ ë¼ì¸(Cache Line)**ì…ë‹ˆë‹¤. CPUëŠ” ë‹¨ 1ë°”ì´íŠ¸ì˜ ë°ì´í„°ë¥¼ ì›í•˜ë”ë¼ë„ í•´ë‹¹ ì£¼ì†Œë¥¼ í¬í•¨í•œ 64ë°”ì´íŠ¸ ë©ì–´ë¦¬ë¥¼ í†µì§¸ë¡œ ìºì‹œë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤. ì´ëŠ” ê³µê°„ì  ì§€ì—­ì„±(Spatial Locality)ì„ í™œìš©í•˜ì—¬ ì´í›„ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ë†’ì€ ì¸ì ‘ ë°ì´í„° ìš”ì²­ì„ ë¯¸ë¦¬ ì²˜ë¦¬í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.

ìºì‹œ ë‚´ì—ì„œ íŠ¹ì • ì£¼ì†Œì˜ ì¡´ì¬ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” ê³¼ì •ì€ í•˜ë“œì›¨ì–´ì  ì£¼ì†Œ ë¶„í•´ë¥¼ í†µí•´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. 64ë¹„íŠ¸ ì£¼ì†Œ ì²´ê³„ëŠ” íƒœê·¸(Tag), ì¸ë±ìŠ¤(Index), ì˜¤í”„ì…‹(Offset)ìœ¼ë¡œ ë‚˜ë‰˜ë©°, ì¸ë±ìŠ¤ ë¹„íŠ¸ë¥¼ í†µí•´ ìºì‹œ ë‚´ íŠ¹ì • ì„¸íŠ¸(Set)ë¥¼ ì¦‰ì‹œ íŠ¹ì •í•©ë‹ˆë‹¤. ì´í›„ í•´ë‹¹ ì„¸íŠ¸ ë‚´ì˜ ì—¬ëŸ¬ ë¼ì¸ì— ì €ì¥ëœ íƒœê·¸ë“¤ê³¼ ìš”ì²­ëœ ì£¼ì†Œì˜ íƒœê·¸ë¥¼ ë³‘ë ¬ íšŒë¡œë¡œ ëŒ€ì¡°í•˜ì—¬ ì¼ì¹˜í•˜ëŠ” ì§€ì ì„ ì°¾ì•„ëƒ…ë‹ˆë‹¤. ì¼ì¹˜(Hit)ê°€ ë°œìƒí•˜ë©´ ì˜¤í”„ì…‹ì„ í†µí•´ 64ë°”ì´íŠ¸ ì¤‘ ì‹¤ì œ í•„ìš”í•œ ë°ì´í„°ë§Œ ALUë¡œ ì „ë‹¬í•˜ë©°, ì´ ëª¨ë“  ê³¼ì •ì€ ë‹¨ ëª‡ ì‚¬ì´í´ ë‚´ì— í•˜ë“œì›¨ì–´ ë¡œì§ë§Œìœ¼ë¡œ ìˆ˜í–‰ë©ë‹ˆë‹¤.

> **ì™œ í•˜í•„ 64ë°”ì´íŠ¸ì¸ê°€?**
> 
> ìºì‹œ ë¼ì¸ì´ 64ë°”ì´íŠ¸ë³´ë‹¤ ì‘ìœ¼ë©´ íƒœê·¸ ì €ì¥ì„ ìœ„í•œ ë©”íƒ€ë°ì´í„° ì˜¤ë²„í—¤ë“œê°€ ì»¤ì§€ê³ , ë„ˆë¬´ í¬ë©´ í•œ ë²ˆì˜ ë¯¸ìŠ¤(Miss) ì‹œ ì „ì†¡ ì§€ì—°ì´ ê¸¸ì–´ì§€ë©° ëŒ€ì—­í­ ë‚­ë¹„ê°€ ë°œìƒí•©ë‹ˆë‹¤. 64ë°”ì´íŠ¸ëŠ” ë²„ìŠ¤ ëŒ€ì—­í­ê³¼ ì§€ì—­ì„± íš¨ìœ¨ ì‚¬ì´ì˜ ìµœì  ì§€ì ìœ¼ë¡œ ì„¤ê³„ëœ ê·œê²©ì…ë‹ˆë‹¤.
{: .prompt-info }

![](/assets/img/2026-01-11-11-36-43.png)

## ğŸ§© L1

L1 ìºì‹œëŠ” ì½”ì–´ ë‚´ë¶€ì˜ ì—°ì‚° íŒŒì´í”„ë¼ì¸ê³¼ ì§ì ‘ ì—°ê²°ëœ ê°€ì¥ ë¹ ë¥´ê³  ë°€ì ‘í•œ ì €ì¥ì†Œì…ë‹ˆë‹¤. ë¬¼ë¦¬ì ìœ¼ë¡œ ALUì™€ ë¶ˆê³¼ ìˆ˜ ë§ˆì´í¬ë¡œë¯¸í„° ê±°ë¦¬ì— ìœ„ì¹˜í•˜ì—¬ ë¹›ì˜ ì´ë™ ì†ë„ì— ì˜í•œ ì§€ì—°ì¡°ì°¨ ê·¹ì†Œí™”í•©ë‹ˆë‹¤. L1ì€ ëª…ë ¹ì–´(Instruction)ë¥¼ ì²˜ë¦¬í•˜ëŠ” L1iì™€ ë°ì´í„°(Data)ë¥¼ ì²˜ë¦¬í•˜ëŠ” L1dë¡œ ë‚˜ë‰˜ì–´ ì¡´ì¬í•©ë‹ˆë‹¤.

ì´ëŸ¬í•œ ë¶„ë¦¬ êµ¬ì¡°ëŠ” íŒŒì´í”„ë¼ì¸ì˜ ê° ë‹¨ê³„ê°€ ë…ë¦½ì ìœ¼ë¡œ ì‘ë™í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. CPUê°€ ì‹¤í–‰í•  ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ L1iì—ì„œ ì½ì–´ì˜¤ëŠ” ë™ì•ˆ(Fetch), í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì—°ì‚°ì— í•„ìš”í•œ ë°ì´í„°ëŠ” L1dì—ì„œ ì½ì–´ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤(Load). ë§Œì•½ ë‹¨ì¼ í†µë¡œì˜€ë‹¤ë©´ ìì› ê²½í•©ì´ ë°œìƒí–ˆê² ì§€ë§Œ, L1ì˜ ì´ì›í™”ëœ ì„¤ê³„ëŠ” ë§¤ ì‚¬ì´í´ë§ˆë‹¤ ëŠê¹€ ì—†ëŠ” ë°ì´í„° ê³µê¸‰ì„ ë³´ì¥í•©ë‹ˆë‹¤. L1dì— ê¸°ë¡ëœ ì—°ì‚° ê²°ê³¼ëŠ” ì¦‰ì‹œ ë©”ëª¨ë¦¬ë¡œ ì „ì†¡ë˜ì§€ ì•Šê³  ìºì‹œì— ë¨¸ë¬¼ë©°, ë‚˜ì¤‘ì— í•œêº¼ë²ˆì— í•˜ìœ„ ê³„ì¸µìœ¼ë¡œ ë°˜ì˜ë˜ëŠ” ì“°ê¸° í›„ í™•ì‚°(Write-back) ë°©ì‹ì„ ì±„íƒí•˜ì—¬ ì‹œìŠ¤í…œ ë²„ìŠ¤ì˜ ë¶€í•˜ë¥¼ ì¤„ì…ë‹ˆë‹¤.

1. **ë³‘ë ¬ ì¸ì¶œ**: CPU ì‚¬ì´í´ì´ ì‹œì‘ë˜ë©´ L1iì—ì„œ ëª…ë ¹ì–´ë¥¼, L1dì—ì„œ í”¼ì—°ì‚°ìë¥¼ ë™ì‹œì— íƒìƒ‰í•©ë‹ˆë‹¤.
2. **ë‹¨ì¼ ì‚¬ì´í´ ë§¤ì¹­**: L1 ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì£¼ì†Œ íƒœê·¸ ë§¤ì¹­ì„ 1~2ì‚¬ì´í´ ë‚´ì— ì™„ë£Œí•˜ê³  ë°ì´í„°ë¥¼ ë ˆì§€ìŠ¤í„°ë¡œ ë³´ëƒ…ë‹ˆë‹¤.
3. **ì—°ì‚° ë° ê°±ì‹ **: ALU ì—°ì‚° ê²°ê³¼ëŠ” ë¨¼ì € L1dì˜ íŠ¹ì • ìºì‹œ ë¼ì¸ì— ê¸°ë¡ë˜ì–´ ë‹¤ìŒ ì—°ì‚°ì—ì„œ ì¦‰ì‹œ ì°¸ì¡°ë  ìˆ˜ ìˆë„ë¡ ëŒ€ê¸°í•©ë‹ˆë‹¤.

![](/assets/img/2026-01-11-11-36-52.png)

## ğŸ§© L2

L1ì˜ í˜‘ì†Œí•œ ê³µê°„ì—ì„œ ë°€ë ¤ë‚œ ë°ì´í„°ë“¤ì€ í•œ ì¸µ ì•„ë˜ì¸ L2 ìºì‹œì— ì•ˆì°©í•©ë‹ˆë‹¤. L2ëŠ” ì—¬ì „íˆ ê° ì½”ì–´ì— ì „ìš©(Private)ìœ¼ë¡œ í• ë‹¹ëœ ê³µê°„ì´ì§€ë§Œ, ì„¤ê³„ì˜ ì£¼ì•ˆì ì€ 'ê·¹ë‹¨ì˜ ì†ë„'ì—ì„œ 'L1ì˜ ë¹ˆë²ˆí•œ ë¯¸ìŠ¤ë¥¼ ë°©ì–´í•˜ê¸° ìœ„í•œ ìš©ëŸ‰ í™•ë³´'ë¡œ ì˜®ê²¨ê°‘ë‹ˆë‹¤.

L2 ìºì‹œëŠ” ë³´í†µ $256\text{ KB}$ì—ì„œ $1\text{ MB}$ ì‚¬ì´ì˜ ìš©ëŸ‰ì„ ê°€ì§‘ë‹ˆë‹¤. L1ë³´ë‹¤ $8$ë°° ì´ìƒ ê±°ëŒ€í•´ì§„ SRAM ì†Œìë“¤ì„ ë°°ì¹˜í•˜ê¸° ìœ„í•´ì„œëŠ” ë” ë„“ì€ ë¬¼ë¦¬ì  ë©´ì ì´ í•„ìš”í•˜ë©°, ì´ëŠ” ê³§ ì—°ì‚° ì¥ì¹˜(ALU)ë¡œë¶€í„°ì˜ ê±°ë¦¬ ì¦ê°€ì™€ ë°°ì„  ë³µì¡ë„ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤. ì´ë¡œ ì¸í•´ L2 ì ‘ê·¼ì—ëŠ” ì•½ $7\text{ ns}$ì—ì„œ $12\text{ ns}$ ê°€ëŸ‰ì˜ ì‹œê°„ì´ ì†Œìš”ë©ë‹ˆë‹¤. ë°ì´í„°ì˜ ê´€ì ì—ì„œëŠ” L1ì—ì„œ ì«“ê²¨ë‚œ ë’¤ RAMì´ë¼ëŠ” ê´‘ì•¼ë¡œ ë‚˜ê°€ê¸° ì „ ë¨¸ë¬´ëŠ” ìµœí›„ì˜ ê°œì¸ ëŒ€ê¸°ì‹¤ì¸ ì…ˆì…ë‹ˆë‹¤.

L1 ìºì‹œ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ íƒœê·¸ ë§¤ì¹­ì— ì‹¤íŒ¨í•˜ë©´ ì¦‰ì‹œ L2ë¡œ ìš”ì²­ì´ ì „íŒŒë©ë‹ˆë‹¤. L2ëŠ” ë” ë†’ì€ ì—°ê´€ë„(Associativity)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì£¼ì†Œ ì¶©ëŒì„ ë°©ì§€í•˜ë©° ë°ì´í„°ë¥¼ íƒìƒ‰í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ ë°ì´í„°ë¥¼ ë°œê²¬í•˜ë©´(Hit) í•´ë‹¹ ìºì‹œ ë¼ì¸ì€ ë‹¤ì‹œ L1ìœ¼ë¡œ ë³µì‚¬ë˜ì–´ 'ìŠ¹ê²©'ë˜ë©°, CPUëŠ” ì—°ì‚°ì„ ì¬ê°œí•©ë‹ˆë‹¤. ë§Œì•½ ìƒˆë¡œìš´ ë°ì´í„°ê°€ ë“¤ì–´ì˜¬ ìë¦¬ê°€ ì—†ë‹¤ë©´, í•˜ë“œì›¨ì–´ëŠ” LRU ì•Œê³ ë¦¬ì¦˜ì„ í†µí•´ ê°€ì¥ ê°€ì¹˜ê°€ ë‚®ì€ ë¼ì¸ì„ ê³¨ë¼ í•˜ìœ„ ê³„ì¸µì¸ L3ë¡œ ë°€ì–´ëƒ…ë‹ˆë‹¤.

> **Inclusive vs Exclusive: ì–´ë–¤ ì„¤ê³„ê°€ ë” ìœ ë¦¬í•œê°€?**
> 
> ìƒìœ„ ê³„ì¸µ(L1)ì˜ ë°ì´í„°ë¥¼ í•˜ìœ„ ê³„ì¸µ(L2)ì´ ëª¨ë‘ í¬í•¨í•˜ëŠëƒ(Inclusive), ì•„ë‹ˆë©´ ì«“ê²¨ë‚œ ë°ì´í„°ë§Œ ë³´ê´€í•˜ëŠëƒ(Exclusive)ëŠ” ì‹¤ë¦¬ì½˜ ê³µê°„ íš¨ìœ¨ì˜ í•µì‹¬ íŠ¸ë ˆì´ë“œì˜¤í”„ì…ë‹ˆë‹¤. í˜„ëŒ€ ì•„í‚¤í…ì²˜ëŠ” ì£¼ë¡œ ì¤‘ë³µì„ ìµœì†Œí™”í•˜ì—¬ ìœ íš¨ ìš©ëŸ‰ì„ ëŠ˜ë¦¬ëŠ” ë¹„í¬í•¨(Non-inclusive) ë°©ì‹ì„ ì„ í˜¸í•©ë‹ˆë‹¤.
{: .prompt-info }

![](/assets/img/2026-01-11-11-37-14.png)

## ğŸ§© L3

ë°ì´í„°ê°€ ê°œë³„ ì½”ì–´ì˜ ê²½ê³„ë¥¼ ë„˜ì–´ ë„ë‹¬í•˜ëŠ” L3 ìºì‹œëŠ” ëª¨ë“  ì½”ì–´ê°€ ìì›ì„ ë‚˜ëˆ„ì–´ ì“°ëŠ” **ì¤‘ì•™ ê´‘ì¥**ì…ë‹ˆë‹¤. ì´ê³³ì€ ë” ì´ìƒ ê°œì¸ì˜ ì†ë„ë¥¼ ìœ„í•œ ê³µê°„ì´ ì•„ë‹ˆë¼, ì‹œìŠ¤í…œ ì „ì²´ì˜ íš¨ìœ¨ê³¼ ë°ì´í„° ì¼ê´€ì„±ì„ ì¡°ìœ¨í•˜ëŠ” **ìµœí›„ ìˆ˜ì¤€ ìºì‹œ(LLC, Last Level Cache)**ë¡œ ê¸°ëŠ¥í•©ë‹ˆë‹¤.

L3ëŠ” ìˆ˜ì‹­ $\text{MB}$ì— ë‹¬í•˜ëŠ” ê±°ëŒ€í•œ ìš©ëŸ‰ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ ê°œì˜ **ìŠ¬ë¼ì´ìŠ¤(Slices)**ë¡œ ë‚˜ë‰˜ì–´ ë‹¤ì´(Die) ì „ì²´ì— ë¶„ì‚° ë°°ì¹˜ë©ë‹ˆë‹¤. ê° ì½”ì–´ì™€ ì´ ìŠ¬ë¼ì´ìŠ¤ë“¤ì€ **ë§ ë²„ìŠ¤(Ring Bus)**ë‚˜ **ë©”ì‹œ(Mesh)** êµ¬ì¡°ì˜ ê³ ì† ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ë¡œ ì—°ê²°ë©ë‹ˆë‹¤. ë°ì´í„° íŒ¨í‚·ì€ ì´ ë„ë¡œë¥¼ ë”°ë¼ ìˆœí™˜í•˜ë©° ìì‹ ì´ í• ë‹¹ëœ ìŠ¬ë¼ì´ìŠ¤ë¥¼ ì°¾ì•„ê°‘ë‹ˆë‹¤. L3ì˜ ì§€ì—° ì‹œê°„ì€ ì•½ $30\text{ ns}$ì—ì„œ $50\text{ ns}$ ìˆ˜ì¤€ìœ¼ë¡œ ëŠ˜ì–´ë‚˜ì§€ë§Œ, ì—¬ì „íˆ $100\text{ ns}$ê°€ ë„˜ëŠ” ë©”ì¸ ë©”ëª¨ë¦¬ì— ë¹„í•˜ë©´ ì••ë„ì ìœ¼ë¡œ íš¨ìœ¨ì ì¸ ì™„ì¶© ì‘ìš©ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

1. **ê¸€ë¡œë²Œ ì¿¼ë¦¬**: ì½”ì–´ê°€ ìì‹ ì˜ L2ì—ì„œ ì‹¤íŒ¨í•œ ì£¼ì†Œë¥¼ ë§ ë²„ìŠ¤ì— íƒœì›Œ ë³´ë‚´ë©´, í•´ì‹œ í•¨ìˆ˜ì— ì˜í•´ ì§€ì •ëœ L3 ìŠ¬ë¼ì´ìŠ¤ê°€ ì´ë¥¼ ìˆ˜ì‹ í•©ë‹ˆë‹¤.
2. **ì¼ê´€ì„± ì¤‘ì¬**: L3ëŠ” ë°ì´í„°ë¥¼ ë‚´ì£¼ê¸° ì „, ë‹¤ë¥¸ ì½”ì–´ì˜ ì „ìš© ìºì‹œ(L1, L2)ì— í•´ë‹¹ ë°ì´í„°ì˜ ìˆ˜ì •ë³¸ì´ ìˆëŠ”ì§€ ë¨¼ì € í™•ì¸í•˜ì—¬ 'ê°€ì¥ ìµœì‹ ì˜ ì§„ì‹¤'ì„ í™•ë³´í•©ë‹ˆë‹¤.
3. **ë©”ëª¨ë¦¬ ë²„ìŠ¤ ì¸í„°í˜ì´ìŠ¤**: L3ì˜ ëª¨ë“  ìŠ¬ë¼ì´ìŠ¤ì—ì„œë„ ë°ì´í„°ë¥¼ ì°¾ì§€ ëª»í•  ê²½ìš°ì—ë§Œ, ë¹„ë¡œì†Œ ì™¸ë¶€ ë©”ëª¨ë¦¬ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í™œì„±í™”í•˜ì—¬ ì™¸ë¶€ RAM ì ‘ê·¼ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.

> **ì™œ L3ëŠ” ì½”ì–´ë§ˆë‹¤ ë”°ë¡œ ë‘ì§€ ì•Šê³  ê³µìœ í•˜ëŠ”ê°€?**
> 
> ë°ì´í„° ê³µìœ ê°€ ë¹ˆë²ˆí•œ ë©€í‹°ì½”ì–´ í™˜ê²½ì—ì„œ ê°ì ìºì‹œë¥¼ í¬ê²Œ ê°€ì§€ë©´ ë°ì´í„° ì¤‘ë³µìœ¼ë¡œ ì¸í•œ ê³µê°„ ë‚­ë¹„ì™€ ì¼ê´€ì„± ìœ ì§€ ë¹„ìš©ì´ í­ì¦í•©ë‹ˆë‹¤. L3ë¥¼ ê³µìœ  ê³µê°„ìœ¼ë¡œ ì„¤ê³„í•¨ìœ¼ë¡œì¨, ì½”ì–´ë“¤ì€ ì„œë¡œì˜ ë°ì´í„°ë¥¼ ë¹ ë¥´ê²Œ ë³µì‚¬í•´ê°ˆ ìˆ˜ ìˆê³  ë©”ëª¨ë¦¬ ì ‘ê·¼ íšŸìˆ˜ë¥¼ ì „ì‚¬ì ìœ¼ë¡œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{: .prompt-info }

![](/assets/img/2026-01-11-11-37-25.png)

## MESI Protocol

ë°ì´í„°ê°€ ê° ì½”ì–´ì˜ ì „ìš© ìºì‹œ(L1, L2)ì— ë³µì œë˜ì–´ ì¡´ì¬í•˜ëŠ” ë©€í‹°ì½”ì–´ í™˜ê²½ì—ì„œëŠ” "ëˆ„ê°€ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì§€ê³  ìˆëŠ”ê°€?"ë¼ëŠ” ì‹ ë¢°ì˜ ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤. í•˜ë“œì›¨ì–´ëŠ” ì´ í˜¼ë€ì„ í•´ê²°í•˜ê¸° ìœ„í•´ ê° ìºì‹œ ë¼ì¸ì˜ ìƒíƒœë¥¼ ì¶”ì í•˜ê³  ì œì–´í•˜ëŠ” **MESI í”„ë¡œí† ì½œ**ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

### ì—¬ëŸ¬ ì½”ì–´ëŠ” ì–´ë–»ê²Œ í•˜ë‚˜ì˜ ì§„ì‹¤ì— í•©ì˜í• ê¹Œ?

ì´ í•©ì˜ì˜ í•µì‹¬ì€ ëª¨ë“  ì½”ì–´ì˜ ìºì‹œ ì»¨íŠ¸ë¡¤ëŸ¬ì— íƒ‘ì¬ëœ **ìŠ¤ëˆ„í•‘(Snooping) ë¡œì§**ì— ìˆìŠµë‹ˆë‹¤. ê° ì½”ì–´ëŠ” ì‹œìŠ¤í…œ ë²„ìŠ¤ë‚˜ ìƒí˜¸ ì—°ê²°ë§(Interconnect)ì„ í†µí•´ íë¥´ëŠ” ë‹¤ë¥¸ ì½”ì–´ì˜ ë©”ëª¨ë¦¬ ìš”ì²­ ì‹ í˜¸ë¥¼ ëŠì„ì—†ì´ ê°ì‹œí•©ë‹ˆë‹¤. íŠ¹ì • ì½”ì–´ê°€ ìì‹ ì´ ê°€ì§„ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ë ¤ í•œë‹¤ëŠ” ì‹ í˜¸ë¥¼ ë³´ë‚´ë©´, ì´ë¥¼ ì—¿ë“£ê³  ìˆë˜ ë‹¤ë¥¸ ì½”ì–´ë“¤ì€ ì¦‰ì‹œ ìì‹ ì˜ ìºì‹œì— ìˆëŠ” í•´ë‹¹ ë°ì´í„°ë¥¼ íê¸°í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸í•  ì¤€ë¹„ë¥¼ í•©ë‹ˆë‹¤.

ìºì‹œ ë¼ì¸ì€ ë‹¤ìŒ ë„¤ ê°€ì§€ ìƒíƒœ ì¤‘ í•˜ë‚˜ë¡œ í‘œì‹œë˜ë©°, ì´ ìƒíƒœëŠ” ì „ì†¡ë˜ëŠ” ì‹ í˜¸ì— ë”°ë¼ ìœ ê¸°ì ìœ¼ë¡œ ë³€í™”í•©ë‹ˆë‹¤.

* **Modified(M)**: í•´ë‹¹ ì½”ì–´ê°€ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ì—¬ RAMì˜ ë‚´ìš©ê³¼ ë‹¬ë¼ì§„ ìƒíƒœì…ë‹ˆë‹¤. ì´ì œ ì´ ì½”ì–´ëŠ” ë°ì´í„°ì˜ ìœ ì¼í•œ ì£¼ì¸ì´ë©°, ë‹¤ë¥¸ ì½”ì–´ê°€ ìš”ì²­í•˜ë©´ ìµœì‹ ë³¸ì„ ê±´ë„¤ì¤„ ì˜ë¬´ê°€ ìƒê¹ë‹ˆë‹¤.
* **Exclusive(E)**: í˜„ì¬ ì´ ì½”ì–´ë§Œ ë°ì´í„°ë¥¼ ê°€ì§€ê³  ìˆì§€ë§Œ, ì•„ì§ ìˆ˜ì •ì€ í•˜ì§€ ì•Šì•„ RAMê³¼ ë°ì´í„°ê°€ ì¼ì¹˜í•˜ëŠ” ìƒíƒœì…ë‹ˆë‹¤.
* **Shared(S)**: ì—¬ëŸ¬ ì½”ì–´ê°€ ë™ì¼í•œ ë°ì´í„°ë¥¼ ì½ê¸° ì „ìš©ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ê°€ì§„ ìƒíƒœì…ë‹ˆë‹¤. ëˆ„êµ¬ë“  ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ë ¤ë©´ ë‹¤ë¥¸ ì½”ì–´ë“¤ì—ê²Œ ë¨¼ì € ì•Œë ¤ì•¼ í•©ë‹ˆë‹¤.
* **Invalid(I)**: ë‹¤ë¥¸ ì½”ì–´ê°€ ë°ì´í„°ë¥¼ ìˆ˜ì •í–ˆê¸° ë•Œë¬¸ì—, ë‚´ ìºì‹œì— ìˆëŠ” ë°ì´í„°ëŠ” ë” ì´ìƒ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ì“°ë ˆê¸°ê°€ ëœ ìƒíƒœì…ë‹ˆë‹¤.

> **ë°ì´í„° ì¼ê´€ì„±ì„ ìœ„í•œ ìˆ¨ê²¨ì§„ ë¹„ìš©**
> 
> MESI í”„ë¡œí† ì½œì€ ë°ì´í„° ì •í•©ì„±ì„ ì™„ë²½íˆ ë³´ì¥í•˜ì§€ë§Œ, ìƒíƒœë¥¼ ë³€ê²½í•  ë•Œë§ˆë‹¤ ë²„ìŠ¤ì— ì‹ í˜¸ë¥¼ ë¿Œë¦¬ê³  ë‹¤ë¥¸ ì½”ì–´ì˜ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” í†µì‹  ë¹„ìš©ì´ ë°œìƒí•©ë‹ˆë‹¤. ì½”ì–´ ìˆ˜ê°€ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ì´ 'í•©ì˜'ë¥¼ ìœ„í•œ íŠ¸ë˜í”½ì´ ê¸°í•˜ê¸‰ìˆ˜ì ìœ¼ë¡œ ì¦ê°€í•˜ë©° ì „ì²´ ì„±ëŠ¥ì˜ ë°œëª©ì„ ì¡ê¸°ë„ í•©ë‹ˆë‹¤.
{: .prompt-info }

![](/assets/img/2026-01-11-11-37-39.png)

## ğŸ§© False Sharing

ì•ì„œ ë‹¤ë£¬ $64\text{ bytes}$ ìºì‹œ ë¼ì¸ ê·œê²©ê³¼ MESI í”„ë¡œí† ì½œì´ ë©€í‹°ì½”ì–´ í™˜ê²½ì—ì„œ ìµœì•…ì˜ ì‹œë„ˆì§€ë¥¼ ë‚´ëŠ” ì§€ì ì´ ë°”ë¡œ **ê°€ì§œ ê³µìœ (False Sharing)**ì…ë‹ˆë‹¤. ì´ëŠ” ë…¼ë¦¬ì ìœ¼ë¡œëŠ” ì™„ë²½í•˜ê²Œ ë…ë¦½ëœ ì½”ë“œê°€ ë¬¼ë¦¬ì ì¸ ë°°ì¹˜ ë•Œë¬¸ì— ì„œë¡œë¥¼ ë°©í•´í•˜ëŠ” í˜„ìƒì…ë‹ˆë‹¤.

### ë…ë¦½ì ì¸ ë°ì´í„°ê°€ ì™œ ì„œë¡œ ì¶©ëŒí• ê¹Œ?

í•˜ë“œì›¨ì–´ëŠ” ì†Œìœ ê¶Œì„ ê´€ë¦¬í•  ë•Œ ë°”ì´íŠ¸ ë‹¨ìœ„ê°€ ì•„ë‹Œ $64\text{ bytes}$ ë©ì–´ë¦¬ ì „ì²´ë¥¼ í•˜ë‚˜ì˜ ë‹¨ìœ„ë¡œ ì·¨ê¸‰í•©ë‹ˆë‹¤. ë§Œì•½ ë‘ ìŠ¤ë ˆë“œê°€ ì„œë¡œ ë‹¤ë¥¸ ë³€ìˆ˜(`var A`, `var B`)ë¥¼ ìˆ˜ì •í•˜ë ¤ëŠ”ë°, ì´ ë‘ ë³€ìˆ˜ê°€ ìš°ì—°íˆ ë©”ëª¨ë¦¬ìƒì—ì„œ ì¸ì ‘í•˜ì—¬ ê°™ì€ $64\text{ bytes}$ ë¼ì¸ ì•ˆì— ë¬¶ì—¬ ìˆë‹¤ë©´ ë¹„ê·¹ì´ ì‹œì‘ë©ë‹ˆë‹¤.

ì½”ì–´ 1ì´ `var A`ë¥¼ ìˆ˜ì •í•˜ëŠ” ìˆœê°„, MESI í”„ë¡œí† ì½œì— ì˜í•´ í•´ë‹¹ ìºì‹œ ë¼ì¸ ì „ì²´ê°€ ì½”ì–´ 1ì˜ ë…ì  ì†Œìœ (**Modified**)ê°€ ë©ë‹ˆë‹¤. ì´ë•Œ `var B`ë¥¼ ìˆ˜ì •í•˜ë ¤ë˜ ì½”ì–´ 2ì˜ ìºì‹œ ë¼ì¸ì€ ì¡¸ì§€ì— **Invalid** ìƒíƒœë¡œ ë³€í•´ë²„ë¦½ë‹ˆë‹¤. ì½”ì–´ 2ëŠ” `var A`ì—ëŠ” ê´€ì‹¬ì¡°ì°¨ ì—†ì—ˆì§€ë§Œ, ê°™ì€ 'ë´‰íˆ¬'ì— ë‹´ê²¨ ìˆì—ˆë‹¤ëŠ” ì´ìœ ë§Œìœ¼ë¡œ ìì‹ ì˜ ë°ì´í„°ë¥¼ ìƒê³  ë‹¤ì‹œ ë©”ëª¨ë¦¬ ê³„ì¸µì„ ë’¤ì ¸ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì•¼ í•©ë‹ˆë‹¤.

1.  **ë™ì‹œ ì ìœ **: ë‘ ì½”ì–´ê°€ ê°™ì€ ìºì‹œ ë¼ì¸ì„ **Shared** ìƒíƒœë¡œ ë¡œë“œí•©ë‹ˆë‹¤.
2.  **ë¬´íš¨í™” ê³µê²©**: ì½”ì–´ 1ì´ ìì‹ ì˜ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ë©° ë¼ì¸ ì „ì²´ì˜ ì†Œìœ ê¶Œì„ ëºì–´ì˜µë‹ˆë‹¤.
3.  **ê°•ì œ ë¯¸ìŠ¤**: ì½”ì–´ 2ëŠ” ë©€ì©¡í•˜ë˜ ìì‹ ì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ë ¤ë‹¤ 'ìºì‹œ ë¯¸ìŠ¤'ë¥¼ ê²ªê³  L3ë‚˜ RAMìœ¼ë¡œ í–¥í•©ë‹ˆë‹¤.
4.  **í•‘í í˜„ìƒ**: ì´ì œ ì½”ì–´ 2ê°€ ì†Œìœ ê¶Œì„ ëºì–´ì˜¤ë©´ ì½”ì–´ 1ì´ ë¯¸ìŠ¤ë¥¼ ê²ªìŠµë‹ˆë‹¤. ë‘ ì½”ì–´ëŠ” ì—°ì‚° ëŒ€ì‹  ì†Œìœ ê¶Œ ì „ìŸì— ëª¨ë“  ì‹œê°„ì„ í—ˆë¹„í•©ë‹ˆë‹¤.

> **ë³´ì´ì§€ ì•ŠëŠ” ì„±ëŠ¥ ì‚´ì¸ë§ˆ**
> 
> ê°€ì§œ ê³µìœ ëŠ” ì½”ë“œìƒì— ëª…ì‹œì ì¸ ì ê¸ˆ(Lock)ì´ë‚˜ ê²½í•©ì´ ì—†ê¸° ë•Œë¬¸ì— ë°œê²¬í•˜ê¸° ë§¤ìš° ì–´ë µìŠµë‹ˆë‹¤. í”„ë¡œê·¸ë¨ì´ ì´ìœ  ì—†ì´ ë‹¨ì¼ ìŠ¤ë ˆë“œë³´ë‹¤ ëŠë ¤ì§€ê±°ë‚˜, ì½”ì–´ ìˆ˜ë¥¼ ëŠ˜ë¦´ìˆ˜ë¡ ì„±ëŠ¥ì´ ë–¨ì–´ì§„ë‹¤ë©´ ë¬¼ë¦¬ì  ë°ì´í„° ë°°ì¹˜ë¥¼ ì˜ì‹¬í•´ì•¼ í•©ë‹ˆë‹¤.
{: .prompt-warning }

![](/assets/img/2026-01-11-11-38-04.png)

## Paddingê³¼ Alignment

ê°€ì§œ ê³µìœ (False Sharing)ê°€ í•˜ë“œì›¨ì–´ì˜ $64\text{-byte}$ ê·œê²©ê³¼ ì†Œí”„íŠ¸ì›¨ì–´ì˜ ì¸ì ‘í•œ ë°ì´í„° ë°°ì¹˜ê°€ ì¶©ëŒí•˜ì—¬ ë°œìƒí•œë‹¤ë©´, í•´ê²°ì±…ì€ ëª…í™•í•©ë‹ˆë‹¤. ë‘ ë°ì´í„°ë¥¼ ë¬¼ë¦¬ì ìœ¼ë¡œ ë©€ë¦¬ ë–¨ì–´ëœ¨ë ¤ ì„œë¡œ ë‹¤ë¥¸ 'ë´‰íˆ¬(Cache Line)'ì— ë‹´ê¸°ê²Œ ë§Œë“œëŠ” ê²ƒì…ë‹ˆë‹¤.

### ì™œ ì¼ë¶€ëŸ¬ ë©”ëª¨ë¦¬ë¥¼ ë‚­ë¹„í•˜ëŠ”ê°€?

ì—”ì§€ë‹ˆì–´ëŠ” ê°€ê¸‰ì  ë©”ëª¨ë¦¬ë¥¼ ì•„ê»´ ì¨ì•¼ í•œë‹¤ëŠ” ë³¸ëŠ¥ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë©€í‹°ì½”ì–´ í™˜ê²½ì—ì„œëŠ” ì´ ë³¸ëŠ¥ì´ ì˜¤íˆë ¤ ì„±ëŠ¥ì„ íŒŒê´´í•©ë‹ˆë‹¤. ê°€ì§œ ê³µìœ ë¥¼ í•´ê²°í•˜ëŠ” ê°€ì¥ í™•ì‹¤í•œ ë°©ë²•ì€ ë³€ìˆ˜ ì‚¬ì´ì— ì•„ë¬´ëŸ° ì˜ë¯¸ ì—†ëŠ” 'ë”ë¯¸ ë°ì´í„°'ë¥¼ ë¼ì›Œ ë„£ëŠ” **íŒ¨ë”©(Padding)** ê¸°ë²•ì…ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ë‘ ê°œì˜ ì¹´ìš´í„° ë³€ìˆ˜ê°€ í•˜ë‚˜ì˜ êµ¬ì¡°ì²´ì— ìˆë‹¤ë©´, ê·¸ ì‚¬ì´ì— $64\text{ bytes}$ í¬ê¸°ì˜ ë¹ˆ ê³µê°„ì„ ê°•ì œë¡œ í• ë‹¹í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì²« ë²ˆì§¸ ë³€ìˆ˜ì™€ ë‘ ë²ˆì§¸ ë³€ìˆ˜ëŠ” ì ˆëŒ€ë¡œ ê°™ì€ ìºì‹œ ë¼ì¸ì— ë¨¸ë¬¼ ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤. ë©”ëª¨ë¦¬ ê³µê°„ì€ ìˆ˜ì‹­ ë°”ì´íŠ¸ ë‚­ë¹„ë˜ì§€ë§Œ, ì½”ì–´ ê°„ì˜ ì†Œìœ ê¶Œ ìŸíƒˆì „(Ping-pong)ì´ ì‚¬ë¼ì§€ë©´ì„œ ì–»ëŠ” ì„±ëŠ¥ ì´ë“ì€ ê·¸ ë¹„ìš©ì„ ì••ë„í•˜ê³ ë„ ë‚¨ìŠµë‹ˆë‹¤.

> **í•˜ë“œì›¨ì–´ ì œì•½ì— ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì •ë ¬í•˜ê¸°**
> 
> ë‹¨ìˆœíˆ ê³µê°„ì„ ë„ìš°ëŠ” ê²ƒë§Œí¼ ì¤‘ìš”í•œ ê²ƒì´ **ë©”ëª¨ë¦¬ ì •ë ¬(Alignment)**ì…ë‹ˆë‹¤. êµ¬ì¡°ì²´ì˜ ì‹œì‘ ì£¼ì†Œê°€ $64$ì˜ ë°°ìˆ˜ê°€ ì•„ë‹ˆë¼ë©´, ì•„ë¬´ë¦¬ íŒ¨ë”©ì„ ë„£ì–´ë„ ë³€ìˆ˜ê°€ ìºì‹œ ë¼ì¸ ê²½ê³„ì— ê±¸ì³ë²„ë ¤ ë‘ ê°œì˜ ë¼ì¸ì„ ë™ì‹œì— ì ìœ í•˜ëŠ” ìµœì•…ì˜ ìƒí™©ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜„ëŒ€ ì–¸ì–´ë“¤ì€ `alignas(64)`ì™€ ê°™ì€ ì§€ì‹œì–´ë¥¼ í†µí•´ ë°ì´í„°ì˜ ì‹œì‘ì ì„ ìºì‹œ ë¼ì¸ ê²½ê³„ì— ê°•ì œë¡œ ë§ì¶”ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
{: .prompt-info }

![](/assets/img/2026-01-11-11-38-12.png)

### ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ 3ë‹¨ê³„ ì ‘ê·¼ë²•

ë©€í‹°ì½”ì–´ ì„±ëŠ¥ ë³‘ëª©ì„ í•´ê²°í•˜ê¸° ìœ„í•´ ì—”ì§€ë‹ˆì–´ëŠ” ë‹¤ìŒì˜ ìˆœì„œë¡œ í•˜ë“œì›¨ì–´ì™€ì˜ êµê°ì„ ì‹œë„í•©ë‹ˆë‹¤.

1. **ë°ì´í„° ê²©ë¦¬**: ë³‘ë ¬ë¡œ ìˆ˜ì •ë˜ëŠ” ë°ì´í„°ë“¤ì„ êµ¬ì¡°ì²´ ë‚´ì—ì„œ ìµœëŒ€í•œ ë©€ë¦¬ ë°°ì¹˜í•˜ê±°ë‚˜, ë³„ë„ì˜ ê°ì²´ë¡œ ë¶„ë¦¬í•©ë‹ˆë‹¤.
2. **ëª…ì‹œì  íŒ¨ë”© ì‚½ì…**: ì–¸ì–´ë³„ íŠ¹ì„±ì— ë§ê²Œ ë”ë¯¸ í•„ë“œ(ì˜ˆ: `_ [56]byte`)ë¥¼ ì¶”ê°€í•˜ì—¬ ê°•ì œë¡œ ìºì‹œ ë¼ì¸ì„ ë¶„ë¦¬í•©ë‹ˆë‹¤.
3. **ì»´íŒŒì¼ëŸ¬ íŒíŠ¸ í™œìš©**: Javaì˜ `@Contended`ë‚˜ C++ì˜ `alignas`ì™€ ê°™ì´ í•˜ë“œì›¨ì–´ ì•„í‚¤í…ì²˜ë¥¼ ì¸ì§€í•˜ëŠ” ì»´íŒŒì¼ëŸ¬ ì§€ì‹œì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ìë™ ìµœì í™”ë¥¼ ìœ ë„í•©ë‹ˆë‹¤.

```cpp
#include <iostream>
#include <thread>
#include <atomic>
#include <new> // std::hardware_destructive_interference_size

/**
 * [ìµœì í™” í¬ì¸íŠ¸]
 * 1. alignas: êµ¬ì¡°ì²´ë‚˜ ë³€ìˆ˜ì˜ ì‹œì‘ ì£¼ì†Œë¥¼ íŠ¹ì • ë°”ì´íŠ¸ ê²½ê³„(ì—¬ê¸°ì„œëŠ” 64ë°”ì´íŠ¸)ë¡œ ë§ì¶¥ë‹ˆë‹¤.
 * 2. hardware_destructive_interference_size: í”Œë«í¼ë³„ ìºì‹œ ë¼ì¸ í¬ê¸°ë¥¼ ë°˜í™˜í•˜ëŠ” ìƒìˆ˜ì…ë‹ˆë‹¤.
 * (ì§€ì›ë˜ì§€ ì•ŠëŠ” í™˜ê²½ì„ ìœ„í•´ ë³´í†µ 64ë°”ì´íŠ¸ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.)
 */

#ifdef __cpp_lib_hardware_interference_size
    using std::hardware_destructive_interference_size;
#else
    // ì¼ë°˜ì ì¸ x86/ARM ì•„í‚¤í…ì²˜ì˜ ìºì‹œ ë¼ì¸ í¬ê¸°ì¸ 64ë°”ì´íŠ¸ë¥¼ ì‚¬ìš©
    constexpr std::size_t hardware_destructive_interference_size = 64;
#endif

// 1. ê°€ì§œ ê³µìœ ê°€ ë°œìƒí•˜ëŠ” êµ¬ì¡°ì²´
struct CriticalData {
    std::atomic<uint64_t> counterA; // ì½”ì–´ 1ì´ ì£¼ë¡œ ìˆ˜ì •
    std::atomic<uint64_t> counterB; // ì½”ì–´ 2ê°€ ì£¼ë¡œ ìˆ˜ì •
};

// 2. íŒ¨ë”©ê³¼ ì •ë ¬ì„ í†µí•´ ê°€ì§œ ê³µìœ ë¥¼ ì œê±°í•œ êµ¬ì¡°ì²´
struct OptimizedData {
    // counterAë¥¼ ìºì‹œ ë¼ì¸ ì‹œì‘ì ì— ì •ë ¬
    alignas(hardware_destructive_interference_size) std::atomic<uint64_t> counterA;

    // counterAì™€ counterB ì‚¬ì´ì— ìºì‹œ ë¼ì¸ í¬ê¸°ë§Œí¼ì˜ ê°„ê²©ì„ ê°•ì œë¡œ ìƒì„±
    // ì´ë¥¼ í†µí•´ ë‘ ë³€ìˆ˜ëŠ” ë¬¼ë¦¬ì ìœ¼ë¡œ ê°™ì€ ìºì‹œ ë¼ì¸ì— ë‹´ê¸¸ ìˆ˜ ì—†ìŒ
    alignas(hardware_destructive_interference_size) std::atomic<uint64_t> counterB;
};

void run_test() {
    OptimizedData data;

    std::cout << "--- Memory Layout Analysis ---" << std::endl;
    std::cout << "Address of A: " << &data.counterA << std::endl;
    std::cout << "Address of B: " << &data.counterB << std::endl;
    
    // ë‘ ì£¼ì†Œì˜ ì°¨ì´ê°€ 64ë°”ì´íŠ¸ ì´ìƒì„ì„ í™•ì¸
    size_t distance = reinterpret_cast<uintptr_t>(&data.counterB) - 
                      reinterpret_cast<uintptr_t>(&data.counterA);
    std::cout << "Distance between A and B: " << distance << " bytes" << std::endl;

    if (distance >= hardware_destructive_interference_size) {
        std::cout << "Result: False Sharing is successfully prevented." << std::endl;
    }
}

int main() {
    run_test();
    return 0;
}
```

## Summary

ë…ë¦½ëœ ë‘ ë³€ìˆ˜ `A`ì™€ `B`ê°€ ìš°ì—°íˆ ë™ì¼í•œ $64\text{-byte}$ ìºì‹œ ë¼ì¸ì— ë†“ì¸ ìƒíƒœì—ì„œ, ì½”ì–´ 1ì€ `A`ë¥¼, ì½”ì–´ 2ëŠ” `B`ë¥¼ ë°˜ë³µ ìˆ˜ì •í•˜ëŠ” **ê°€ì§œ ê³µìœ (False Sharing)** ìƒí™©ì—ì„œì˜ ë°ì´í„° í”„ë¡œì„¸ìŠ¤ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì •ë¦¬í•©ë‹ˆë‹¤.

1. **ìƒíƒœ ê³µìœ (Initial Loading)**: ì½”ì–´ 1ê³¼ ì½”ì–´ 2ê°€ ë©”ëª¨ë¦¬ì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ì™€ ê°ê°ì˜ ì „ìš© ìºì‹œ(L1/L2)ì— ì ì¬í•©ë‹ˆë‹¤. ì´ë•Œ ë‘ ì½”ì–´ì˜ ìºì‹œ ë¼ì¸ ìƒíƒœëŠ” **Shared(S)**ê°€ ë©ë‹ˆë‹¤.
2. **ìˆ˜ì • ë° ë¬´íš¨í™” ì „íŒŒ(Invalidation)**: ì½”ì–´ 1ì´ ë³€ìˆ˜ `A`ë¥¼ ìˆ˜ì •í•˜ê¸° ìœ„í•´ ìƒí˜¸ ì—°ê²°ë§(Bus)ì— ë¬´íš¨í™”(Invalidate) ì‹ í˜¸ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤. ì´ ì‹ í˜¸ë¥¼ ìˆ˜ì‹ í•œ ì½”ì–´ 2ì˜ ìºì‹œ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” í•´ë‹¹ ë¼ì¸ì„ ì¦‰ì‹œ **Invalid(I)** ìƒíƒœë¡œ ì „í™˜í•©ë‹ˆë‹¤.
3. **ë…ì ì  ìƒíƒœ ì „í™˜(Exclusivity)**: ì½”ì–´ 1ì˜ ìºì‹œ ë¼ì¸ ìƒíƒœëŠ” **Modified(M)**ê°€ ë˜ë©°, í•´ë‹¹ ë¼ì¸ì— ëŒ€í•œ ìœ ì¼í•œ ìµœì‹  ë°ì´í„° ì†Œìœ ê¶Œì„ íšë“í•©ë‹ˆë‹¤. 
4. **ê°•ì œ ìºì‹œ ë¯¸ìŠ¤ ë°œìƒ(Forced Miss)**: ì½”ì–´ 2ê°€ ë³€ìˆ˜ `B`ë¥¼ ì½ìœ¼ë ¤ í•  ë•Œ, ë¹„ë¡ `B` ê°’ ìì²´ëŠ” ë³€ê²½ë˜ì§€ ì•Šì•˜ìœ¼ë‚˜ ë¼ì¸ ì „ì²´ê°€ ë¬´íš¨í™”ë˜ì—ˆìœ¼ë¯€ë¡œ ìºì‹œ ë¯¸ìŠ¤ê°€ ë°œìƒí•©ë‹ˆë‹¤. ì½”ì–´ 2ëŠ” ì½”ì–´ 1ì˜ ìºì‹œ í˜¹ì€ í•˜ìœ„ ê³„ì¸µìœ¼ë¡œë¶€í„° ë°ì´í„°ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì™€ì•¼ í•©ë‹ˆë‹¤.
5. **ì„±ëŠ¥ í•˜ë½(Ping-pong)**: ì½”ì–´ 2ê°€ ë‹¤ì‹œ ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•˜ë©´ ì½”ì–´ 1ì˜ ë¼ì¸ì´ ë¬´íš¨í™”ë˜ëŠ” ê³¼ì •ì´ ë°˜ë³µë©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ ë°œìƒí•˜ëŠ” ë²„ìŠ¤ íŠ¸ë˜í”½ê³¼ ë™ê¸°í™” ì§€ì—°ìœ¼ë¡œ ì¸í•´ CPUì˜ ì—°ì‚° ìì›ì´ ë‚­ë¹„ë˜ë©° ë³‘ë ¬ ì²˜ë¦¬ íš¨ìœ¨ì´ ê¸‰ê²©íˆ ì €í•˜ë©ë‹ˆë‹¤.

## References

* [[Gist] Latency Numbers Every Programmer Should Know](https://gist.github.com/jboner/2841832)
* [[Wiki] MESI protocol](https://en.wikipedia.org/wiki/MESI_protocol)
* [[Blog] Mechanical Sympathy: False Sharing](https://mechanical-sympathy.blogspot.com/2011/07/false-sharing.html)
* [[Dev.to] False Sharing in Go â€” The Hidden Enemy](https://dev.to/kelvinfloresta/false-sharing-in-go-the-hidden-enemy-in-your-concurrency-37ni)